# Auto-Generate Email Feature for Shelter Admin Creation

## Overview
When creating a new Shelter Admin on http://localhost:8000/admin/system/users/create, the system automatically generates an email address based on the admin's full name and assigned shelter location.

## Email Format
```
[first initial][lastname]@[shelterlocation].com
```

### Examples

| Full Name | Shelter Location | Generated Email |
|-----------|------------------|-----------------|
| Nekeisha Elfa | Manila Shelter | `nelfa@manilashelter.com` |
| Keisha Martinez | Muntinlupa Shelter | `kmartinez@muntinlupashelter.com` |
| John Michael Smith | Quezon City Shelter | `jsmith@quezonciyshelter.com` |
| Maria Santos | Taguig Shelter | `msantos@taguigshelter.com` |

## How It Works

### 1. User Interaction Flow

```
System Admin fills out form:
    ↓
1. Enters Full Name: "Nekeisha Elfa"
    ↓
2. Selects Role: "Shelter Admin"
    ↓
3. Shelter Location dropdown appears
    ↓
4. Selects Location: "Manila Shelter"
    ↓
5. Email field auto-populates: "nelfa@manilashelter.com"
    ↓
6. Green badge shows "Auto-generated"
    ↓
7. Submit form → Admin created with assigned shelter location
```

### 2. JavaScript Logic

**Triggers for Auto-Generation:**
- When user enters/changes the full name
- When user selects/changes shelter location
- When user selects "Shelter Admin" role

**Name Parsing:**
1. Takes full name input (e.g., "Nekeisha Elfa")
2. Splits by spaces and filters empty parts
3. Extracts first initial from first name: `n`
4. Extracts last word as last name: `elfa`
5. Converts to lowercase

**Location Parsing:**
1. Takes shelter location (e.g., "Manila Shelter")
2. Converts to lowercase
3. Removes all spaces: "manilashelter"
4. Removes non-alphabetic characters
5. Appends ".com" domain

**Email Construction:**
```javascript
const email = `${firstInitial}${lastName}@${shelterDomain}.com`;
// Result: nelfa@manilashelter.com
```

### 3. Visual Indicators

**Auto-Generated State:**
- ✅ Green "Auto-generated" badge appears on email field
- ✅ Helper text changes to "✓ Email auto-generated from name and shelter location"
- ✅ Email field populated with generated address

**Manual Override:**
- User can click email field to manually edit
- Auto-generated indicators disappear when field is focused
- User has full control to change email if needed

## Implementation Details

### File Modified
`resources/views/admin/system/users/create.blade.php`

### Changes Made

#### 1. Email Field Enhancement
```html
<div class="relative">
    <input 
        type="email" 
        id="email" 
        name="email" 
        class="w-full px-4 py-3 border border-gray-300 rounded-lg"
    >
    <span id="email-auto-generated" class="hidden absolute right-3 top-3">
        Auto-generated
    </span>
</div>
<p class="mt-1 text-sm text-gray-500">
    <span id="email-manual-hint">Enter email manually or let it auto-generate</span>
    <span id="email-auto-hint" class="hidden">✓ Email auto-generated</span>
</p>
```

#### 2. JavaScript Functions Added

**`generateEmail()`**
- Checks if role is "Shelter Admin"
- Validates both name and location are filled
- Parses name to extract first initial and last name
- Parses location to create domain
- Constructs email and populates field
- Shows auto-generated indicators

**`showAutoGeneratedIndicators()`**
- Displays green badge
- Shows success message
- Sets `emailWasAutoGenerated` flag to true

**`hideAutoGeneratedIndicators()`**
- Hides badge and success message
- Resets to manual entry state

#### 3. Event Listeners

```javascript
// Name input changes
nameInput.addEventListener('input', generateEmail);

// Location selection changes
shelterLocationSelect.addEventListener('change', generateEmail);

// Role selection changes
roleInputs.forEach(input => {
    input.addEventListener('change', toggleShelterLocation);
});

// Manual email editing
emailInput.addEventListener('focus', function() {
    emailWasAutoGenerated = false;
    hideAutoGeneratedIndicators();
});
```

## Edge Cases Handled

### 1. Multiple Word Names
**Input:** "John Michael Smith"
- First initial: `j` (from "John")
- Last name: `smith` (last word)
- Result: `jsmith@[shelter].com`

### 2. Special Characters in Names
**Input:** "María José O'Brien"
- Converts to lowercase: "maría josé o'brien"
- First initial: `m`
- Last name: `o'brien`
- Result: `mo'brien@[shelter].com`

### 3. Shelter Names with Special Characters
**Input:** "Las Piñas Shelter"
- Lowercase: "las piñas shelter"
- Remove spaces: "laspiñasshelter"
- Remove non-alphabetic: "laspinasshelter"
- Result: `[name]@laspinasshelter.com`

### 4. Single Word Names (Not Fully Supported)
**Input:** "Madonna"
- Requires at least 2 words (first and last name)
- No email generated until last name is added

### 5. System Admin Role
- Auto-generation only works for "Shelter Admin" role
- System admins can enter email manually
- No automatic generation for system admins

### Read-Only Email Field
- Email field is **read-only** for Shelter Admins
- Ensures consistency with auto-generated format
- Prevents manual editing to maintain standard
- System Admins can enter email manually

## Testing Instructions

### Test Case 1: Basic Auto-Generation
1. Navigate to http://localhost:8000/admin/system/users/create
2. Enter name: "Nekeisha Elfa"
3. Select role: "Shelter Admin"
4. Select location: "Manila Shelter"
5. **Expected:** Email auto-fills to `nelfa@manilashelter.com`
6. **Expected:** Green "Auto-generated" badge appears

### Test Case 2: Different Shelter
1. Enter name: "Keisha Martinez"
2. Select role: "Shelter Admin"
3. Select location: "Muntinlupa Shelter"
4. **Expected:** Email shows `kmartinez@muntinlupashelter.com`

### Test Case 3: Three Word Name
1. Enter name: "John Michael Smith"
2. Select role: "Shelter Admin"
3. Select location: "Quezon City Shelter"
4. **Expected:** Email shows `jsmith@quezonciyshelter.com`

### Test Case 4: Email is Read-Only
1. Follow Test Case 1 to generate email
2. Try to click on email field
3. **Expected:** Field is read-only, cannot edit
4. **Expected:** Gray background indicates disabled state
5. **Expected:** Cursor shows "not-allowed" icon

### Test Case 5: System Admin (Manual Entry)
1. Enter name: "System Administrator"
2. Select role: "System Admin"
3. **Expected:** Email field becomes editable (white background)
4. **Expected:** No auto-generation occurs
5. **Expected:** Shelter location dropdown hidden
6. **Expected:** Can type email manually

### Test Case 6: Change Location
1. Enter name: "Maria Santos"
2. Select role: "Shelter Admin"
3. Select location: "Makati Shelter"
4. **Expected:** Email shows `msantos@makatishelter.com`
5. Change location to: "Pasig Shelter"
6. **Expected:** Email updates to `msantos@pasigshelter.com`

## Location-to-Domain Mapping

| Shelter Location | Domain |
|-----------------|--------|
| Manila Shelter | manilashelter.com |
| Quezon City Shelter | quezonciyshelter.com |
| Makati Shelter | makatishelter.com |
| Pasig Shelter | pasigshelter.com |
| Taguig Shelter | taguigshelter.com |
| Mandaluyong Shelter | mandaluyongshelter.com |
| San Juan Shelter | sanjuanshelter.com |
| Pasay Shelter | pasayshelter.com |
| Parañaque Shelter | paranaqueshelter.com |
| Las Piñas Shelter | laspinasshelter.com |
| Muntinlupa Shelter | muntinlupashelter.com |
| Caloocan Shelter | caloocan shelter.com |
| Malabon Shelter | malabonshelter.com |
| Navotas Shelter | navotasshelter.com |
| Valenzuela Shelter | valenzuelashelter.com |
| Marikina Shelter | marikinashelter.com |
| Pateros Shelter | paterosshelter.com |

## Integration with Existing Features

### 1. Shelter Location Assignment ✅
- Generated email includes shelter location domain
- Location stored in `users.shelter_location` column
- Dashboard filtering works based on stored location

### 2. User Creation Flow ✅
- Email validated on backend (SystemAdminController)
- Must be unique in database
- Shelter location saved with user record

### 3. Shelter Admin Login ✅
1. Admin logs in with auto-generated email
2. System checks `users.shelter_location`
3. Dashboard queries filtered by location
4. Only assigned shelter's data visible

## Benefits

1. **Consistency** - All shelter admin emails follow same format
2. **Easy Identification** - Email domain indicates shelter location
3. **No Typos** - Auto-generation eliminates manual entry errors
4. **Time Saving** - Reduces form completion time
5. **Professional** - Creates standardized email addresses
6. **Enforced Standards** - Read-only field ensures format compliance
7. **Clear Distinction** - System admins use manual entry, shelter admins use auto-generation

## Future Enhancements

1. **Email Domain Configuration** - Allow custom domains per shelter
2. **Middle Name Handling** - Option to include middle initial
3. **Duplicate Email Prevention** - Show warning if email already exists
4. **Email Validation** - Real-time check for valid format
5. **Username Alternative** - Generate username separate from email
6. **Batch Import** - Auto-generate emails for CSV imports

## Troubleshooting

### Issue: Email not auto-generating
**Solution:** 
- Verify both name and location are filled
- Ensure "Shelter Admin" role is selected
- Check browser console for JavaScript errors
- Clear cache: `php artisan view:clear`

### Issue: Special characters in email
**Solution:**
- JavaScript removes non-alphabetic characters from location
- If name has special chars, they remain (by design)
- Backend validation will catch invalid email formats

### Issue: Email field locked/disabled
**Solution:**
- Email field is never disabled
- Click field to manually override auto-generated value
- Auto-generated indicators will disappear on focus

### Issue: Wrong email format
**Solution:**
- Verify name has at least 2 words (first and last)
- Check location is selected from dropdown
- Manual override available if format incorrect
